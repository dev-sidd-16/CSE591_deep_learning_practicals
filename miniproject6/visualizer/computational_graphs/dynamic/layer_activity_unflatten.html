<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="d3viz/css/d3viz.css"/>
	<link rel="stylesheet" href="d3viz/css/d3-context-menu.css"/>
	<script type="text/javascript" src="d3viz/js/d3viz.js"></script>
	<script type="text/javascript" src="d3viz/js/d3.v3.min.js"></script>
	<script type="text/javascript" src="d3viz/js/dagre-d3.min.js"></script>
	<script type="text/javascript" src="d3viz/js/graphlib-dot.min.js"></script>
	<script type="text/javascript" src="d3viz/js/d3-context-menu.js"></script>
</head>
<body>
	<div id='menu' class='menuBar'>
	    <input name="resetNodes" 
	           type="button" 
	           value="Reset nodes"
	           onclick="resetNodes()"/>
	    <input name="releaseNodes" 
	           type="button" 
	           value="Release nodes"
	           onclick="releaseNodes()"/>
	</div>

	<script type="text/javascript">
		// Backend graph in DOT format
		var dotGraph = graphlibDot.read("digraph G {\n\tgraph [bb=\"0,0,548,1112\"];\n\tnode [label=\"\\N\"];\n\tn1\t [apply_op=GpuDimShuffle,\n\t\theight=0.5,\n\t\tlabel=GpuDimShuffle,\n\t\tnode_type=apply,\n\t\tpos=\"67,458\",\n\t\tshape=ellipse,\n\t\twidth=1.8694];\n\tn34\t [apply_op=GpuElemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=GpuElemwise,\n\t\tnode_type=apply,\n\t\tpos=\"163,370\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.6958];\n\tn1 -> n34\t [label=\"2 float32\",\n\t\tlp=\"124.5,414\",\n\t\tpos=\"e,130.22,385.31 75.307,439.87 81.12,429.17 89.677,415.65 100,406 106.31,400.1 113.79,394.84 121.36,390.3\"];\n\tn2\t [dtype=fvector,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=bias,\n\t\tnode_type=input,\n\t\tpos=\"67,546\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn2 -> n1\t [color=dodgerblue,\n\t\tlabel=fvector,\n\t\tlp=\"86.5,502\",\n\t\tpos=\"e,67,476.08 67,527.6 67,515.75 67,499.82 67,486.29\"];\n\tn4\t [apply_op=GpuDimShuffle,\n\t\theight=0.5,\n\t\tlabel=GpuDimShuffle,\n\t\tnode_type=apply,\n\t\tpos=\"481,600\",\n\t\tshape=ellipse,\n\t\twidth=1.8694];\n\tn32\t [apply_op=GpuDot22,\n\t\theight=0.5,\n\t\tlabel=GpuDot22,\n\t\tnode_type=apply,\n\t\tpos=\"275,458\",\n\t\tshape=ellipse,\n\t\twidth=1.3347];\n\tn4 -> n32\t [label=\"1 float32\",\n\t\tlp=\"455.5,546\",\n\t\tpos=\"e,297.76,473.9 458.02,583.04 428.16,562.35 374.37,525.22 328,494 321.05,489.32 313.57,484.34 306.47,479.65\"];\n\tn5\t [dtype=fmatrix,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=weights,\n\t\tnode_type=input,\n\t\tpos=\"487,742\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.8125];\n\tn5 -> n4\t [color=dodgerblue,\n\t\tlabel=fmatrix,\n\t\tlp=\"506.5,698\",\n\t\tpos=\"e,481.74,618.31 486.26,723.83 485.24,700.01 483.39,656.66 482.17,628.35\"];\n\tn27\t [apply_op=GpuDot22,\n\t\theight=0.5,\n\t\tlabel=GpuDot22,\n\t\tnode_type=apply,\n\t\tpos=\"409,654\",\n\t\tshape=ellipse,\n\t\twidth=1.3347];\n\tn5 -> n27\t [label=\"1 fmatrix\",\n\t\tlp=\"456,698\",\n\t\tpos=\"e,413.09,672.05 457.68,727.7 447.87,722.12 437.53,714.84 430,706 424.02,698.98 419.57,690.02 416.34,681.58\"];\n\tn7\t [apply_op=GpuDimShuffle,\n\t\theight=0.5,\n\t\tlabel=GpuDimShuffle,\n\t\tnode_type=apply,\n\t\tpos=\"275,654\",\n\t\tshape=ellipse,\n\t\twidth=1.8694];\n\tn29\t [apply_op=GpuElemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=GpuElemwise,\n\t\tnode_type=apply,\n\t\tpos=\"275,546\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.6958];\n\tn7 -> n29\t [label=\"2 float32\",\n\t\tlp=\"299.5,600\",\n\t\tpos=\"e,275,564.34 275,635.97 275,619.38 275,593.88 275,574.43\"];\n\tn8\t [dtype=fvector,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=bias,\n\t\tnode_type=input,\n\t\tpos=\"266,742\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn8 -> n7\t [color=dodgerblue,\n\t\tlabel=fvector,\n\t\tlp=\"291.5,698\",\n\t\tpos=\"e,273.21,672.08 267.82,723.6 269.06,711.75 270.73,695.82 272.14,682.29\"];\n\tn10\t [apply_op=Elemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=Elemwise,\n\t\tnode_type=apply,\n\t\tpos=\"122,1006\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.2798];\n\tn17\t [apply_op=ScalarFromTensor,\n\t\theight=0.5,\n\t\tlabel=ScalarFromTensor,\n\t\tnode_type=apply,\n\t\tpos=\"122,918\",\n\t\tshape=ellipse,\n\t\twidth=2.1207];\n\tn10 -> n17\t [label=lscalar,\n\t\tlp=\"140,962\",\n\t\tpos=\"e,122,936.08 122,987.6 122,975.75 122,959.82 122,946.29\"];\n\tn11\t [dtype=lscalar,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=500,\n\t\tnode_type=constant_input,\n\t\tpos=\"191,1094\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn11 -> n10\t [label=\"0 lscalar\",\n\t\tlp=\"146,1050\",\n\t\tpos=\"e,118.12,1024.3 163.74,1086.3 148.99,1081.2 131.99,1072.4 123,1058 118.7,1051.1 117.35,1042.6 117.4,1034.5\"];\n\tn15\t [apply_op=Elemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=Elemwise,\n\t\tnode_type=apply,\n\t\tpos=\"293,1006\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.2798];\n\tn11 -> n15\t [label=\"0 lscalar\",\n\t\tlp=\"279,1050\",\n\t\tpos=\"e,276.57,1023.1 215.29,1075.7 222.71,1070.2 230.8,1064 238,1058 248.48,1049.3 259.59,1039.2 269.05,1030.3\"];\n\tn12\t [dtype=lscalar,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=1,\n\t\tnode_type=constant_input,\n\t\tpos=\"53,1094\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn12 -> n10\t [label=\"1 lscalar\",\n\t\tlp=\"91,1050\",\n\t\tpos=\"e,93.443,1020.3 55.022,1075.6 56.956,1065 60.716,1051.8 68,1042 72.546,1035.9 78.492,1030.6 84.772,1026\"];\n\tn13\t [dtype=lscalar,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=index,\n\t\tnode_type=input,\n\t\tpos=\"296,1094\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn13 -> n10\t [label=\"2 lscalar\",\n\t\tlp=\"211,1050\",\n\t\tpos=\"e,142.79,1022.1 268.63,1087.2 246.05,1081.8 213.68,1072.3 188,1058 178.35,1052.6 177.65,1048.9 169,1042 163.19,1037.4 156.88,1032.6 \\\n150.82,1028\"];\n\tn13 -> n15\t [label=\"1 lscalar\",\n\t\tlp=\"331,1050\",\n\t\tpos=\"e,301.33,1024.1 303.3,1075.6 306.53,1065.7 309.16,1053.2 307,1042 306.47,1039.3 305.73,1036.5 304.87,1033.7\"];\n\tn19\t [apply_op=ScalarFromTensor,\n\t\theight=0.5,\n\t\tlabel=ScalarFromTensor,\n\t\tnode_type=apply,\n\t\tpos=\"293,918\",\n\t\tshape=ellipse,\n\t\twidth=2.1207];\n\tn15 -> n19\t [label=lscalar,\n\t\tlp=\"311,962\",\n\t\tpos=\"e,293,936.08 293,987.6 293,975.75 293,959.82 293,946.29\"];\n\tn21\t [apply_op=GpuSubtensor,\n\t\tfillcolor=\"#FFAAFF\",\n\t\theight=0.5,\n\t\tlabel=GpuSubtensor,\n\t\tnode_type=apply,\n\t\tpos=\"293,830\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.6958];\n\tn17 -> n21\t [label=\"2 fmatrix\",\n\t\tlp=\"249,874\",\n\t\tpos=\"e,263.41,845.88 152.97,901.43 181.4,887.13 223.65,865.88 254.3,850.47\"];\n\tn19 -> n21\t [label=\"1 fmatrix\",\n\t\tlp=\"319,874\",\n\t\tpos=\"e,293,848.08 293,899.6 293,887.75 293,871.82 293,858.29\"];\n\tn24\t [apply_op=GpuReshape,\n\t\theight=0.5,\n\t\tlabel=GpuReshape,\n\t\tnode_type=apply,\n\t\tpos=\"367,742\",\n\t\tshape=ellipse,\n\t\twidth=1.5402];\n\tn21 -> n24\t [color=dodgerblue,\n\t\tlabel=\"0 fmatrix\",\n\t\tlp=\"353,786\",\n\t\tpos=\"e,346.5,759.12 302.68,812.13 308.99,801.79 317.74,788.56 327,778 330.65,773.84 334.79,769.7 338.98,765.81\"];\n\tn22\t [dtype=fmatrix,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=fmatrix,\n\t\tnode_type=input,\n\t\tpos=\"416,918\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.78472];\n\tn22 -> n21\t [color=dodgerblue,\n\t\tlabel=\"0 fmatrix\",\n\t\tlp=\"396,874\",\n\t\tpos=\"e,318.69,846.37 394.65,899.95 381.67,889.79 364.63,876.8 349,866 342.17,861.28 334.72,856.43 327.55,851.9\"];\n\tn24 -> n27\t [label=\"0 lvector\",\n\t\tlp=\"382.5,698\",\n\t\tpos=\"e,379.5,668.41 358.82,724.09 355.04,713.73 352.47,700.5 358,690 361.19,683.94 365.96,678.72 371.33,674.3\"];\n\tn25\t [dtype=lvector,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=\"[500  -1]\",\n\t\tnode_type=constant_input,\n\t\tpos=\"405,830\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.89583];\n\tn25 -> n24\t [label=\"1 lvector\",\n\t\tlp=\"414.5,786\",\n\t\tpos=\"e,374.55,760.08 397.31,811.6 391.97,799.51 384.76,783.18 378.71,769.49\"];\n\tn27 -> n29\t [color=red,\n\t\tlabel=\"1 float32\",\n\t\tlp=\"379.5,600\",\n\t\tpos=\"e,301.93,562.25 382.93,638.68 373.59,632.91 363.33,625.78 355,618 340.38,604.35 342.56,595.71 328,582 322.65,576.96 316.49,572.17 \\\n310.3,567.84\"];\n\tn29 -> n32\t [label=\"0 float32\",\n\t\tlp=\"299.5,502\",\n\t\tpos=\"e,275,476.08 275,527.6 275,515.75 275,499.82 275,486.29\"];\n\tn30\t [dtype=float32,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=\"[[ 0.5]]\",\n\t\tnode_type=constant_input,\n\t\tpos=\"161,654\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.76389];\n\tn30 -> n29\t [label=\"0 float32\",\n\t\tlp=\"246.5,600\",\n\t\tpos=\"e,248.62,562.38 173.62,635.75 185.2,620.59 203.35,598.44 222,582 227.57,577.09 233.89,572.34 240.16,568\"];\n\tn30 -> n34\t [label=\"0 float32\",\n\t\tlp=\"187.5,502\",\n\t\tpos=\"e,162.88,388.35 161.12,635.78 161.46,588.49 162.4,456.26 162.8,398.54\"];\n\tn32 -> n34\t [color=red,\n\t\tlabel=\"1 float32\",\n\t\tlp=\"254.5,414\",\n\t\tpos=\"e,183.99,387.12 254.98,441.62 237.47,428.18 211.83,408.49 192.06,393.31\"];\n\tn36\t [apply_op=GpuReshape,\n\t\theight=0.5,\n\t\tlabel=GpuReshape,\n\t\tnode_type=apply,\n\t\tpos=\"237,282\",\n\t\tshape=ellipse,\n\t\twidth=1.5402];\n\tn34 -> n36\t [color=dodgerblue,\n\t\tlabel=\"0 float32\",\n\t\tlp=\"229.5,326\",\n\t\tpos=\"e,221.52,299.58 176.4,352.28 184.55,342.24 195.23,329.26 205,318 208.06,314.48 211.33,310.8 214.57,307.21\"];\n\tn39\t [apply_op=GpuDimShuffle,\n\t\theight=0.5,\n\t\tlabel=GpuDimShuffle,\n\t\tnode_type=apply,\n\t\tpos=\"237,194\",\n\t\tshape=ellipse,\n\t\twidth=1.8694];\n\tn36 -> n39\t [color=dodgerblue,\n\t\tlabel=lvector,\n\t\tlp=\"256,238\",\n\t\tpos=\"e,237,212.08 237,263.6 237,251.75 237,235.82 237,222.29\"];\n\tn37\t [dtype=lvector,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=\"[500  28  28]\",\n\t\tnode_type=constant_input,\n\t\tpos=\"286,370\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=1.2083];\n\tn37 -> n36\t [label=\"1 lvector\",\n\t\tlp=\"290.5,326\",\n\t\tpos=\"e,246.57,299.79 276.08,351.6 269.09,339.31 259.59,322.65 251.71,308.82\"];\n\tn41\t [apply_op=HostFromGpu,\n\t\tfillcolor=red,\n\t\theight=0.5,\n\t\tlabel=HostFromGpu,\n\t\tnode_type=apply,\n\t\tpos=\"237,106\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.7048];\n\tn39 -> n41\t [label=lvector,\n\t\tlp=\"256,150\",\n\t\tpos=\"e,237,124.08 237,175.6 237,163.75 237,147.82 237,134.29\"];\n\tn42\t [dtype=float32,\n\t\tfillcolor=dodgerblue,\n\t\theight=0.5,\n\t\tlabel=float32,\n\t\tnode_type=output,\n\t\tpos=\"237,18\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75694];\n\tn41 -> n42\t [label=float32,\n\t\tlp=\"256.5,62\",\n\t\tpos=\"e,237,36.084 237,87.597 237,75.746 237,59.817 237,46.292\"];\n}\n");
		// Frontend graph for visualization
		var graph = {};
		
		var forceLayout;
		var isProfiled = false; // true if profiling information available
		var useProfileColors = false;
		var fixOnInit = true; // fix nodes on initialization
		var maxProfilePer = 0;
		var profileColors = ["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15"];
		var pad = 10;
		var isEditNode = false; // true if node is edited
		var menuItems = [
			{
				title: 'Edit',
				action: function(elm, d, i) { editNode(elm, d); }
			},
			{
				title: 'Release',
				action: function(elm, d, i) { releaseNode(d); }
			}
		];

		// Create main panel
		d3.select('body').select('svg').remove();
		var svg = d3.select('body').append('svg')
			.attr('width', '100%')
			.attr('height', '95%');
		var pane = svg.append('g');
		
		// Zoom behaviour
		var zoom = d3.behavior.zoom()
			.scaleExtent([0.2, 8])
			.on('zoom', function(d) {
				var trans = d3.event.translate;
				trans[0] += 300;
				trans[1] += 100;
				pane.attr('transform', 'translate(' + trans + ') scale(' + d3.event.scale + ')');
			});
		svg.call(zoom);
		zoom.event(svg);
		svg.on("dblclick.zoom", null);
		
		// Edges
		var edgeDiv = d3.select('body').append('div')
			.attr('class', 'edgeTooltip')
			.style('opacity', 0.0);
		
		// Div for node details	
		var nodeInfo = d3.select('body').append('div')
			.attr('class', 'nodeInfo')
			.style('opacity', 0.0);
		
		// Definition head of edges
		var markerData = [
			{'id': 'n', 'color': 'black'},
			{'id': 'r', 'color': 'red'},
			{'id': 'b', 'color': 'dodgerblue'}];
		svg.append("defs").selectAll('marker').data(markerData).enter().append("marker")
		    .attr("id", function(d) { return 'edgeArrow_' + d.id;})
		    .attr("markerWidth", 4)
		    .attr("markerHeight", 4)
		    .attr("refX", 2)
		    .attr("refY", 2)
		    .attr("orient", "auto")
		  	.append("path")
		    .attr("d", "M0,0 L4,2 L0,4 Z")
		    .attr('fill', function(d) { return d.color;});
	
		// Initialize graph
		processDotGraph(dotGraph);		
		graph = frontEndGraph(dotGraph);
		drawGraph();
	</script>
</body>
</html>
