<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="d3viz/css/d3viz.css"/>
	<link rel="stylesheet" href="d3viz/css/d3-context-menu.css"/>
	<script type="text/javascript" src="d3viz/js/d3viz.js"></script>
	<script type="text/javascript" src="d3viz/js/d3.v3.min.js"></script>
	<script type="text/javascript" src="d3viz/js/dagre-d3.min.js"></script>
	<script type="text/javascript" src="d3viz/js/graphlib-dot.min.js"></script>
	<script type="text/javascript" src="d3viz/js/d3-context-menu.js"></script>
</head>
<body>
	<div id='menu' class='menuBar'>
	    <input name="resetNodes" 
	           type="button" 
	           value="Reset nodes"
	           onclick="resetNodes()"/>
	    <input name="releaseNodes" 
	           type="button" 
	           value="Release nodes"
	           onclick="releaseNodes()"/>
	</div>

	<script type="text/javascript">
		// Backend graph in DOT format
		var dotGraph = graphlibDot.read("digraph G {\n\tgraph [bb=\"0,0,740,1376\"];\n\tnode [label=\"\\N\"];\n\tn1\t [apply_op=GpuDimShuffle,\n\t\theight=0.5,\n\t\tlabel=GpuDimShuffle,\n\t\tnode_type=apply,\n\t\tpos=\"494,722\",\n\t\tshape=ellipse,\n\t\twidth=1.8694];\n\tn39\t [apply_op=GpuElemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=GpuElemwise,\n\t\tnode_type=apply,\n\t\tpos=\"451,634\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.6958];\n\tn1 -> n39\t [label=\"2 float32\",\n\t\tlp=\"501.5,678\",\n\t\tpos=\"e,459.48,651.96 485.5,704.01 479.38,691.76 471,675 464.03,661.06\"];\n\tn2\t [dtype=fvector,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=bias,\n\t\tnode_type=input,\n\t\tpos=\"535,810\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn2 -> n1\t [color=dodgerblue,\n\t\tlabel=fvector,\n\t\tlp=\"538.5,766\",\n\t\tpos=\"e,502.14,740.08 526.7,791.6 520.94,779.51 513.16,763.18 506.63,749.49\"];\n\tn4\t [apply_op=GpuDimShuffle,\n\t\theight=0.5,\n\t\tlabel=GpuDimShuffle,\n\t\tnode_type=apply,\n\t\tpos=\"673,864\",\n\t\tshape=ellipse,\n\t\twidth=1.8694];\n\tn37\t [apply_op=GpuDot22,\n\t\theight=0.5,\n\t\tlabel=GpuDot22,\n\t\tnode_type=apply,\n\t\tpos=\"360,722\",\n\t\tshape=ellipse,\n\t\twidth=1.3347];\n\tn4 -> n37\t [label=\"1 float32\",\n\t\tlp=\"474.5,810\",\n\t\tpos=\"e,383.44,737.79 619.95,852.89 606.91,850.52 592.96,848.08 580,846 522.41,836.75 498.83,859.91 450,828 419.43,808.03 431.64,784.94 \\\n407,758 402.39,752.96 396.96,748.15 391.46,743.8\"];\n\tn5\t [dtype=fmatrix,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=weights,\n\t\tnode_type=input,\n\t\tpos=\"591,1006\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.8125];\n\tn5 -> n4\t [color=dodgerblue,\n\t\tlabel=fmatrix,\n\t\tlp=\"640.5,962\",\n\t\tpos=\"e,663.12,881.87 601.05,987.83 615.27,963.56 641.36,919.03 657.9,890.77\"];\n\tn30\t [apply_op=GpuDot22,\n\t\theight=0.5,\n\t\tlabel=GpuDot22,\n\t\tnode_type=apply,\n\t\tpos=\"454,918\",\n\t\tshape=ellipse,\n\t\twidth=1.3347];\n\tn5 -> n30\t [label=\"1 fmatrix\",\n\t\tlp=\"561,962\",\n\t\tpos=\"e,477.69,933.87 563.61,987.8 541.31,973.81 509.8,954.02 486.28,939.26\"];\n\tn7\t [apply_op=GpuDimShuffle,\n\t\theight=0.5,\n\t\tlabel=GpuDimShuffle,\n\t\tnode_type=apply,\n\t\tpos=\"320,918\",\n\t\tshape=ellipse,\n\t\twidth=1.8694];\n\tn34\t [apply_op=GpuElemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=GpuElemwise,\n\t\tnode_type=apply,\n\t\tpos=\"344,810\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.6958];\n\tn7 -> n34\t [label=\"2 float32\",\n\t\tlp=\"360.5,864\",\n\t\tpos=\"e,340.15,827.99 323.86,899.97 327.65,883.2 333.51,857.34 337.93,837.81\"];\n\tn8\t [dtype=fvector,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=bias,\n\t\tnode_type=input,\n\t\tpos=\"320,1006\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn8 -> n7\t [color=dodgerblue,\n\t\tlabel=fvector,\n\t\tlp=\"339.5,962\",\n\t\tpos=\"e,320,936.08 320,987.6 320,975.75 320,959.82 320,946.29\"];\n\tn10\t [apply_op=Elemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=Elemwise,\n\t\tnode_type=apply,\n\t\tpos=\"96,1270\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.2798];\n\tn17\t [apply_op=ScalarFromTensor,\n\t\theight=0.5,\n\t\tlabel=ScalarFromTensor,\n\t\tnode_type=apply,\n\t\tpos=\"96,1182\",\n\t\tshape=ellipse,\n\t\twidth=2.1207];\n\tn10 -> n17\t [label=lscalar,\n\t\tlp=\"114,1226\",\n\t\tpos=\"e,96,1200.1 96,1251.6 96,1239.7 96,1223.8 96,1210.3\"];\n\tn11\t [dtype=lscalar,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=500,\n\t\tnode_type=constant_input,\n\t\tpos=\"148,1358\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn11 -> n10\t [label=\"0 lscalar\",\n\t\tlp=\"120,1314\",\n\t\tpos=\"e,92.572,1288.1 120.75,1344.9 111.53,1339.3 102.25,1331.7 97,1322 93.143,1314.8 91.923,1306.3 91.945,1298.2\"];\n\tn15\t [apply_op=Elemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=Elemwise,\n\t\tnode_type=apply,\n\t\tpos=\"267,1270\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.2798];\n\tn11 -> n15\t [label=\"0 lscalar\",\n\t\tlp=\"189,1314\",\n\t\tpos=\"e,224.38,1277 150.19,1339.8 152.43,1328.8 156.94,1315 166,1306 179.04,1293 197.11,1284.9 214.36,1279.7\"];\n\tn12\t [dtype=lscalar,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=1,\n\t\tnode_type=constant_input,\n\t\tpos=\"27,1358\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn12 -> n10\t [label=\"1 lscalar\",\n\t\tlp=\"66,1314\",\n\t\tpos=\"e,68.059,1284.5 29.438,1339.6 31.607,1329 35.63,1315.8 43,1306 47.516,1300 53.376,1294.7 59.548,1290.2\"];\n\tn13\t [dtype=lscalar,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=index,\n\t\tnode_type=input,\n\t\tpos=\"251,1358\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn13 -> n10\t [label=\"2 lscalar\",\n\t\tlp=\"252,1314\",\n\t\tpos=\"e,138.5,1277.2 241.54,1339.6 234.69,1328.5 224.46,1314.6 212,1306 193.19,1293 169.42,1284.7 148.3,1279.5\"];\n\tn13 -> n15\t [label=\"1 lscalar\",\n\t\tlp=\"306,1314\",\n\t\tpos=\"e,276.85,1287.8 269.96,1339.7 274.44,1334.5 278.61,1328.5 281,1322 283.94,1314 282.94,1305.2 280.45,1297.1\"];\n\tn19\t [apply_op=ScalarFromTensor,\n\t\theight=0.5,\n\t\tlabel=ScalarFromTensor,\n\t\tnode_type=apply,\n\t\tpos=\"267,1182\",\n\t\tshape=ellipse,\n\t\twidth=2.1207];\n\tn15 -> n19\t [label=lscalar,\n\t\tlp=\"285,1226\",\n\t\tpos=\"e,267,1200.1 267,1251.6 267,1239.7 267,1223.8 267,1210.3\"];\n\tn21\t [apply_op=GpuSubtensor,\n\t\tfillcolor=\"#FFAAFF\",\n\t\theight=0.5,\n\t\tlabel=GpuSubtensor,\n\t\tnode_type=apply,\n\t\tpos=\"267,1094\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.6958];\n\tn17 -> n21\t [label=\"2 fmatrix\",\n\t\tlp=\"223,1138\",\n\t\tpos=\"e,237.41,1109.9 126.97,1165.4 155.4,1151.1 197.65,1129.9 228.3,1114.5\"];\n\tn19 -> n21\t [label=\"1 fmatrix\",\n\t\tlp=\"293,1138\",\n\t\tpos=\"e,267,1112.1 267,1163.6 267,1151.7 267,1135.8 267,1122.3\"];\n\tn24\t [apply_op=GpuReshape,\n\t\theight=0.5,\n\t\tlabel=GpuReshape,\n\t\tnode_type=apply,\n\t\tpos=\"430,1006\",\n\t\tshape=ellipse,\n\t\twidth=1.5402];\n\tn21 -> n24\t [color=dodgerblue,\n\t\tlabel=\"0 fmatrix\",\n\t\tlp=\"390,1050\",\n\t\tpos=\"e,402.2,1021.7 295.39,1078 322.47,1063.7 363.4,1042.1 393.02,1026.5\"];\n\tn27\t [apply_op=GpuReshape,\n\t\theight=0.5,\n\t\tlabel=GpuReshape,\n\t\tnode_type=apply,\n\t\tpos=\"244,546\",\n\t\tshape=ellipse,\n\t\twidth=1.5402];\n\tn21 -> n27\t [color=dodgerblue,\n\t\tlabel=\"0 lvector\",\n\t\tlp=\"240.5,810\",\n\t\tpos=\"e,234.99,563.93 250.02,1076.6 235.18,1060.4 216,1034.3 216,1007 216,1007 216,1007 216,633 216,612.13 223.55,589.75 230.81,573.05\"];\n\tn22\t [dtype=fmatrix,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=fmatrix,\n\t\tnode_type=input,\n\t\tpos=\"390,1182\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.78472];\n\tn22 -> n21\t [color=dodgerblue,\n\t\tlabel=\"0 fmatrix\",\n\t\tlp=\"370,1138\",\n\t\tpos=\"e,292.69,1110.4 368.65,1163.9 355.67,1153.8 338.63,1140.8 323,1130 316.17,1125.3 308.72,1120.4 301.55,1115.9\"];\n\tn24 -> n30\t [label=\"0 lvector\",\n\t\tlp=\"469.5,962\",\n\t\tpos=\"e,449.27,935.96 434.74,988.01 438.09,975.99 442.66,959.64 446.5,945.87\"];\n\tn25\t [dtype=lvector,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=\"[500  -1]\",\n\t\tnode_type=constant_input,\n\t\tpos=\"430,1094\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.89583];\n\tn25 -> n24\t [label=\"1 lvector\",\n\t\tlp=\"454.5,1050\",\n\t\tpos=\"e,430,1024.1 430,1075.6 430,1063.7 430,1047.8 430,1034.3\"];\n\tn32\t [apply_op=GpuDimShuffle,\n\t\theight=0.5,\n\t\tlabel=GpuDimShuffle,\n\t\tnode_type=apply,\n\t\tpos=\"244,458\",\n\t\tshape=ellipse,\n\t\twidth=1.8694];\n\tn27 -> n32\t [color=dodgerblue,\n\t\tlabel=fmatrix,\n\t\tlp=\"264.5,502\",\n\t\tpos=\"e,244,476.08 244,527.6 244,515.75 244,499.82 244,486.29\"];\n\tn28\t [dtype=lvector,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=\"[500  28  28]\",\n\t\tnode_type=constant_input,\n\t\tpos=\"304,634\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=1.2083];\n\tn28 -> n27\t [label=\"1 lvector\",\n\t\tlp=\"304.5,590\",\n\t\tpos=\"e,255.72,563.79 291.86,615.6 283.12,603.08 271.22,586.01 261.46,572.03\"];\n\tn41\t [apply_op=GpuReshape,\n\t\theight=0.5,\n\t\tlabel=GpuReshape,\n\t\tnode_type=apply,\n\t\tpos=\"397,546\",\n\t\tshape=ellipse,\n\t\twidth=1.5402];\n\tn28 -> n41\t [label=\"1 lvector\",\n\t\tlp=\"383.5,590\",\n\t\tpos=\"e,379.47,563.21 322.82,615.6 336.92,602.56 356.36,584.58 371.81,570.3\"];\n\tn30 -> n34\t [color=red,\n\t\tlabel=\"1 float32\",\n\t\tlp=\"448.5,864\",\n\t\tpos=\"e,366.12,827.02 440.27,900.48 427.59,885.6 407.91,863.45 389,846 384.32,841.68 379.15,837.33 374.04,833.22\"];\n\tn45\t [apply_op=GpuElemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=GpuElemwise,\n\t\tnode_type=apply,\n\t\tpos=\"330,370\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.6958];\n\tn32 -> n45\t [label=\"0 lvector\",\n\t\tlp=\"319.5,414\",\n\t\tpos=\"e,313.47,387.53 260.58,440.42 273.55,427.45 291.75,409.25 306.26,394.74\"];\n\tn34 -> n37\t [label=\"0 float32\",\n\t\tlp=\"378.5,766\",\n\t\tpos=\"e,356.79,740.25 347.16,792.01 349.38,780.07 352.4,763.85 354.95,750.14\"];\n\tn35\t [dtype=float32,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=\"[[ 0.5]]\",\n\t\tnode_type=constant_input,\n\t\tpos=\"569,918\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.76389];\n\tn35 -> n34\t [label=\"0 float32\",\n\t\tlp=\"551.5,864\",\n\t\tpos=\"e,391.6,821.42 548.85,899.92 526.66,881.39 492.12,853.44 477,846 463.48,839.35 430.95,830.74 401.46,823.73\"];\n\tn35 -> n39\t [label=\"0 float32\",\n\t\tlp=\"612.5,766\",\n\t\tpos=\"e,494.63,646.7 573.93,899.86 583.78,862.15 602.29,770.13 570,704 557.22,677.84 529.62,660.94 504.22,650.42\"];\n\tn37 -> n39\t [color=red,\n\t\tlabel=\"1 float32\",\n\t\tlp=\"438.5,678\",\n\t\tpos=\"e,433.65,651.4 377.12,704.82 391.01,691.69 410.78,673.01 426.38,658.27\"];\n\tn39 -> n41\t [color=dodgerblue,\n\t\tlabel=\"0 float32\",\n\t\tlp=\"453.5,590\",\n\t\tpos=\"e,407.65,563.96 440.33,616.01 432.57,603.64 421.91,586.68 413.11,572.66\"];\n\tn43\t [apply_op=GpuDimShuffle,\n\t\theight=0.5,\n\t\tlabel=GpuDimShuffle,\n\t\tnode_type=apply,\n\t\tpos=\"397,458\",\n\t\tshape=ellipse,\n\t\twidth=1.8694];\n\tn41 -> n43\t [color=dodgerblue,\n\t\tlabel=lvector,\n\t\tlp=\"416,502\",\n\t\tpos=\"e,397,476.08 397,527.6 397,515.75 397,499.82 397,486.29\"];\n\tn43 -> n45\t [color=red,\n\t\tlabel=\"1 lvector\",\n\t\tlp=\"394.5,414\",\n\t\tpos=\"e,342.98,387.66 383.76,440.01 373.88,427.32 360.23,409.8 349.16,395.59\"];\n\tn47\t [apply_op=GpuCAReduce,\n\t\theight=0.5,\n\t\tlabel=GpuCAReduce,\n\t\tnode_type=apply,\n\t\tpos=\"330,282\",\n\t\tshape=ellipse,\n\t\twidth=1.7826];\n\tn45 -> n47\t [label=lvector,\n\t\tlp=\"349,326\",\n\t\tpos=\"e,330,300.08 330,351.6 330,339.75 330,323.82 330,310.29\"];\n\tn49\t [apply_op=GpuElemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=GpuElemwise,\n\t\tnode_type=apply,\n\t\tpos=\"404,194\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.6958];\n\tn47 -> n49\t [color=red,\n\t\tlabel=\"1 fscalar\",\n\t\tlp=\"396.5,238\",\n\t\tpos=\"e,389.09,211.66 343.84,264.38 352.22,254.36 363.16,241.39 373,230 376.01,226.52 379.2,222.87 382.35,219.29\"];\n\tn52\t [apply_op=HostFromGpu,\n\t\tfillcolor=red,\n\t\theight=0.5,\n\t\tlabel=HostFromGpu,\n\t\tnode_type=apply,\n\t\tpos=\"404,106\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.7048];\n\tn49 -> n52\t [label=fscalar,\n\t\tlp=\"422.5,150\",\n\t\tpos=\"e,404,124.08 404,175.6 404,163.75 404,147.82 404,134.29\"];\n\tn50\t [dtype=fscalar,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=\"  2.551e-06\",\n\t\tnode_type=constant_input,\n\t\tpos=\"452,282\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=1.0903];\n\tn50 -> n49\t [label=\"0 fscalar\",\n\t\tlp=\"456.5,238\",\n\t\tpos=\"e,413.37,211.79 442.29,263.6 435.43,251.31 426.13,234.65 418.41,220.82\"];\n\tn53\t [dtype=fscalar,\n\t\tfillcolor=dodgerblue,\n\t\theight=0.5,\n\t\tlabel=fscalar,\n\t\tnode_type=output,\n\t\tpos=\"404,18\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn52 -> n53\t [label=fscalar,\n\t\tlp=\"422.5,62\",\n\t\tpos=\"e,404,36.084 404,87.597 404,75.746 404,59.817 404,46.292\"];\n}\n");
		// Frontend graph for visualization
		var graph = {};
		
		var forceLayout;
		var isProfiled = false; // true if profiling information available
		var useProfileColors = false;
		var fixOnInit = true; // fix nodes on initialization
		var maxProfilePer = 0;
		var profileColors = ["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15"];
		var pad = 10;
		var isEditNode = false; // true if node is edited
		var menuItems = [
			{
				title: 'Edit',
				action: function(elm, d, i) { editNode(elm, d); }
			},
			{
				title: 'Release',
				action: function(elm, d, i) { releaseNode(d); }
			}
		];

		// Create main panel
		d3.select('body').select('svg').remove();
		var svg = d3.select('body').append('svg')
			.attr('width', '100%')
			.attr('height', '95%');
		var pane = svg.append('g');
		
		// Zoom behaviour
		var zoom = d3.behavior.zoom()
			.scaleExtent([0.2, 8])
			.on('zoom', function(d) {
				var trans = d3.event.translate;
				trans[0] += 300;
				trans[1] += 100;
				pane.attr('transform', 'translate(' + trans + ') scale(' + d3.event.scale + ')');
			});
		svg.call(zoom);
		zoom.event(svg);
		svg.on("dblclick.zoom", null);
		
		// Edges
		var edgeDiv = d3.select('body').append('div')
			.attr('class', 'edgeTooltip')
			.style('opacity', 0.0);
		
		// Div for node details	
		var nodeInfo = d3.select('body').append('div')
			.attr('class', 'nodeInfo')
			.style('opacity', 0.0);
		
		// Definition head of edges
		var markerData = [
			{'id': 'n', 'color': 'black'},
			{'id': 'r', 'color': 'red'},
			{'id': 'b', 'color': 'dodgerblue'}];
		svg.append("defs").selectAll('marker').data(markerData).enter().append("marker")
		    .attr("id", function(d) { return 'edgeArrow_' + d.id;})
		    .attr("markerWidth", 4)
		    .attr("markerHeight", 4)
		    .attr("refX", 2)
		    .attr("refY", 2)
		    .attr("orient", "auto")
		  	.append("path")
		    .attr("d", "M0,0 L4,2 L0,4 Z")
		    .attr('fill', function(d) { return d.color;});
	
		// Initialize graph
		processDotGraph(dotGraph);		
		graph = frontEndGraph(dotGraph);
		drawGraph();
	</script>
</body>
</html>
