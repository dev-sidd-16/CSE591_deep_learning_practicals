<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="d3viz/css/d3viz.css"/>
	<link rel="stylesheet" href="d3viz/css/d3-context-menu.css"/>
	<script type="text/javascript" src="d3viz/js/d3viz.js"></script>
	<script type="text/javascript" src="d3viz/js/d3.v3.min.js"></script>
	<script type="text/javascript" src="d3viz/js/dagre-d3.min.js"></script>
	<script type="text/javascript" src="d3viz/js/graphlib-dot.min.js"></script>
	<script type="text/javascript" src="d3viz/js/d3-context-menu.js"></script>
</head>
<body>
	<div id='menu' class='menuBar'>
	    <input name="resetNodes" 
	           type="button" 
	           value="Reset nodes"
	           onclick="resetNodes()"/>
	    <input name="releaseNodes" 
	           type="button" 
	           value="Release nodes"
	           onclick="releaseNodes()"/>
	</div>

	<script type="text/javascript">
		// Backend graph in DOT format
		var dotGraph = graphlibDot.read("digraph G {\n\tgraph [bb=\"0,0,419,740\"];\n\tnode [label=\"\\N\"];\n\tn1\t [apply_op=GpuDimShuffle,\n\t\theight=0.5,\n\t\tlabel=GpuDimShuffle,\n\t\tnode_type=apply,\n\t\tpos=\"134,282\",\n\t\tshape=ellipse,\n\t\twidth=1.8694];\n\tn24\t [apply_op=GpuElemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=GpuElemwise,\n\t\tnode_type=apply,\n\t\tpos=\"268,194\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.6958];\n\tn1 -> n24\t [label=\"2 float32\",\n\t\tlp=\"238.5,238\",\n\t\tpos=\"e,243.58,210.67 158.58,265.23 180.02,251.47 211.3,231.39 234.93,216.22\"];\n\tn2\t [dtype=fvector,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=bias,\n\t\tnode_type=input,\n\t\tpos=\"134,370\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn2 -> n1\t [color=dodgerblue,\n\t\tlabel=fvector,\n\t\tlp=\"153.5,326\",\n\t\tpos=\"e,134,300.08 134,351.6 134,339.75 134,323.82 134,310.29\"];\n\tn4\t [apply_op=Elemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=Elemwise,\n\t\tnode_type=apply,\n\t\tpos=\"96,634\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.2798];\n\tn11\t [apply_op=ScalarFromTensor,\n\t\theight=0.5,\n\t\tlabel=ScalarFromTensor,\n\t\tnode_type=apply,\n\t\tpos=\"96,546\",\n\t\tshape=ellipse,\n\t\twidth=2.1207];\n\tn4 -> n11\t [label=lscalar,\n\t\tlp=\"114,590\",\n\t\tpos=\"e,96,564.08 96,615.6 96,603.75 96,587.82 96,574.29\"];\n\tn5\t [dtype=lscalar,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=500,\n\t\tnode_type=constant_input,\n\t\tpos=\"148,722\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn5 -> n4\t [label=\"0 lscalar\",\n\t\tlp=\"120,678\",\n\t\tpos=\"e,92.572,652.06 120.75,708.87 111.53,703.3 102.25,695.74 97,686 93.143,678.85 91.923,670.27 91.945,662.2\"];\n\tn9\t [apply_op=Elemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=Elemwise,\n\t\tnode_type=apply,\n\t\tpos=\"267,634\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.2798];\n\tn5 -> n9\t [label=\"0 lscalar\",\n\t\tlp=\"189,678\",\n\t\tpos=\"e,224.38,641.03 150.19,703.82 152.43,692.83 156.94,679 166,670 179.04,657.04 197.11,648.87 214.36,643.72\"];\n\tn6\t [dtype=lscalar,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=1,\n\t\tnode_type=constant_input,\n\t\tpos=\"27,722\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn6 -> n4\t [label=\"1 lscalar\",\n\t\tlp=\"66,678\",\n\t\tpos=\"e,68.059,648.51 29.438,703.58 31.607,693.04 35.63,679.78 43,670 47.516,664.01 53.376,658.72 59.548,654.2\"];\n\tn7\t [dtype=lscalar,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=index,\n\t\tnode_type=input,\n\t\tpos=\"251,722\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn7 -> n4\t [label=\"2 lscalar\",\n\t\tlp=\"252,678\",\n\t\tpos=\"e,138.5,641.24 241.54,703.57 234.69,692.48 224.46,678.63 212,670 193.19,656.98 169.42,648.7 148.3,643.49\"];\n\tn7 -> n9\t [label=\"1 lscalar\",\n\t\tlp=\"306,678\",\n\t\tpos=\"e,276.85,651.77 269.96,703.74 274.44,698.52 278.61,692.46 281,686 283.94,678.04 282.94,669.18 280.45,661.11\"];\n\tn13\t [apply_op=ScalarFromTensor,\n\t\theight=0.5,\n\t\tlabel=ScalarFromTensor,\n\t\tnode_type=apply,\n\t\tpos=\"267,546\",\n\t\tshape=ellipse,\n\t\twidth=2.1207];\n\tn9 -> n13\t [label=lscalar,\n\t\tlp=\"285,590\",\n\t\tpos=\"e,267,564.08 267,615.6 267,603.75 267,587.82 267,574.29\"];\n\tn15\t [apply_op=GpuSubtensor,\n\t\tfillcolor=\"#FFAAFF\",\n\t\theight=0.5,\n\t\tlabel=GpuSubtensor,\n\t\tnode_type=apply,\n\t\tpos=\"267,458\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.6958];\n\tn11 -> n15\t [label=\"2 fmatrix\",\n\t\tlp=\"223,502\",\n\t\tpos=\"e,237.41,473.88 126.97,529.43 155.4,515.13 197.65,493.88 228.3,478.47\"];\n\tn13 -> n15\t [label=\"1 fmatrix\",\n\t\tlp=\"293,502\",\n\t\tpos=\"e,267,476.08 267,527.6 267,515.75 267,499.82 267,486.29\"];\n\tn18\t [apply_op=GpuReshape,\n\t\theight=0.5,\n\t\tlabel=GpuReshape,\n\t\tnode_type=apply,\n\t\tpos=\"341,370\",\n\t\tshape=ellipse,\n\t\twidth=1.5402];\n\tn15 -> n18\t [color=dodgerblue,\n\t\tlabel=\"0 fmatrix\",\n\t\tlp=\"327,414\",\n\t\tpos=\"e,320.5,387.12 276.68,440.13 282.99,429.79 291.74,416.56 301,406 304.65,401.84 308.79,397.7 312.98,393.81\"];\n\tn16\t [dtype=fmatrix,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=fmatrix,\n\t\tnode_type=input,\n\t\tpos=\"390,546\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.78472];\n\tn16 -> n15\t [color=dodgerblue,\n\t\tlabel=\"0 fmatrix\",\n\t\tlp=\"370,502\",\n\t\tpos=\"e,292.69,474.37 368.65,527.95 355.67,517.79 338.63,504.8 323,494 316.17,489.28 308.72,484.43 301.55,479.9\"];\n\tn21\t [apply_op=GpuDot22,\n\t\theight=0.5,\n\t\tlabel=GpuDot22,\n\t\tnode_type=apply,\n\t\tpos=\"268,282\",\n\t\tshape=ellipse,\n\t\twidth=1.3347];\n\tn18 -> n21\t [label=\"0 lvector\",\n\t\tlp=\"341.5,326\",\n\t\tpos=\"e,286.02,298.71 330.44,352.31 323.65,342.03 314.37,328.81 305,318 301.47,313.93 297.53,309.81 293.56,305.9\"];\n\tn19\t [dtype=lvector,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=\"[500  -1]\",\n\t\tnode_type=constant_input,\n\t\tpos=\"379,458\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.89583];\n\tn19 -> n18\t [label=\"1 lvector\",\n\t\tlp=\"388.5,414\",\n\t\tpos=\"e,348.55,388.08 371.31,439.6 365.97,427.51 358.76,411.18 352.71,397.49\"];\n\tn21 -> n24\t [color=red,\n\t\tlabel=\"1 float32\",\n\t\tlp=\"292.5,238\",\n\t\tpos=\"e,268,212.08 268,263.6 268,251.75 268,235.82 268,222.29\"];\n\tn22\t [dtype=fmatrix,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=weights,\n\t\tnode_type=input,\n\t\tpos=\"238,370\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.8125];\n\tn22 -> n21\t [label=\"1 fmatrix\",\n\t\tlp=\"279,326\",\n\t\tpos=\"e,260.26,299.93 242.5,351.84 245.25,341.87 249,329.12 253,318 254.01,315.2 255.12,312.3 256.28,309.43\"];\n\tn27\t [apply_op=HostFromGpu,\n\t\tfillcolor=red,\n\t\theight=0.5,\n\t\tlabel=HostFromGpu,\n\t\tnode_type=apply,\n\t\tpos=\"268,106\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.7048];\n\tn24 -> n27\t [label=float32,\n\t\tlp=\"287.5,150\",\n\t\tpos=\"e,268,124.08 268,175.6 268,163.75 268,147.82 268,134.29\"];\n\tn25\t [dtype=float32,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=\"[[ 0.5]]\",\n\t\tnode_type=constant_input,\n\t\tpos=\"362,282\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.76389];\n\tn25 -> n24\t [label=\"0 float32\",\n\t\tlp=\"360.5,238\",\n\t\tpos=\"e,294.52,210.23 350.26,263.8 342.64,253.34 332.09,240.1 321,230 315.51,225 309.23,220.2 302.97,215.86\"];\n\tn28\t [dtype=fmatrix,\n\t\tfillcolor=dodgerblue,\n\t\theight=0.5,\n\t\tlabel=fmatrix,\n\t\tnode_type=output,\n\t\tpos=\"268,18\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.78472];\n\tn27 -> n28\t [label=fmatrix,\n\t\tlp=\"288.5,62\",\n\t\tpos=\"e,268,36.084 268,87.597 268,75.746 268,59.817 268,46.292\"];\n}\n");
		// Frontend graph for visualization
		var graph = {};
		
		var forceLayout;
		var isProfiled = false; // true if profiling information available
		var useProfileColors = false;
		var fixOnInit = true; // fix nodes on initialization
		var maxProfilePer = 0;
		var profileColors = ["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15"];
		var pad = 10;
		var isEditNode = false; // true if node is edited
		var menuItems = [
			{
				title: 'Edit',
				action: function(elm, d, i) { editNode(elm, d); }
			},
			{
				title: 'Release',
				action: function(elm, d, i) { releaseNode(d); }
			}
		];

		// Create main panel
		d3.select('body').select('svg').remove();
		var svg = d3.select('body').append('svg')
			.attr('width', '100%')
			.attr('height', '95%');
		var pane = svg.append('g');
		
		// Zoom behaviour
		var zoom = d3.behavior.zoom()
			.scaleExtent([0.2, 8])
			.on('zoom', function(d) {
				var trans = d3.event.translate;
				trans[0] += 300;
				trans[1] += 100;
				pane.attr('transform', 'translate(' + trans + ') scale(' + d3.event.scale + ')');
			});
		svg.call(zoom);
		zoom.event(svg);
		svg.on("dblclick.zoom", null);
		
		// Edges
		var edgeDiv = d3.select('body').append('div')
			.attr('class', 'edgeTooltip')
			.style('opacity', 0.0);
		
		// Div for node details	
		var nodeInfo = d3.select('body').append('div')
			.attr('class', 'nodeInfo')
			.style('opacity', 0.0);
		
		// Definition head of edges
		var markerData = [
			{'id': 'n', 'color': 'black'},
			{'id': 'r', 'color': 'red'},
			{'id': 'b', 'color': 'dodgerblue'}];
		svg.append("defs").selectAll('marker').data(markerData).enter().append("marker")
		    .attr("id", function(d) { return 'edgeArrow_' + d.id;})
		    .attr("markerWidth", 4)
		    .attr("markerHeight", 4)
		    .attr("refX", 2)
		    .attr("refY", 2)
		    .attr("orient", "auto")
		  	.append("path")
		    .attr("d", "M0,0 L4,2 L0,4 Z")
		    .attr('fill', function(d) { return d.color;});
	
		// Initialize graph
		processDotGraph(dotGraph);		
		graph = frontEndGraph(dotGraph);
		drawGraph();
	</script>
</body>
</html>
